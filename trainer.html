<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trainer Dashboard</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #1f2a38;
    color: white;
    margin: 0;
    padding: 20px;
}

h1 {
    text-align: center;
    margin-bottom: 30px;
}

.controls {
    text-align: center;
    margin-bottom: 20px;
}

select, button {
    padding: 8px;
    margin: 5px;
    border-radius: 6px;
    border: none;
    font-weight: bold;
}

button {
    background: #4CAF50;
    color: white;
    cursor: pointer;
}

button:hover {
    opacity: 0.9;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255,255,255,0.05);
}

th, td {
    padding: 10px;
    text-align: center;
}

th {
    background: #4CAF50;
}

tr:nth-child(even) {
    background: rgba(255,255,255,0.05);
}

.summary {
    margin-top: 20px;
    text-align: center;
    font-size: 18px;
}
</style>
</head>

<body>

<h1>Trainer Dashboard</h1>

<div class="controls">
    <select id="userFilter">
        <option value="">All Users</option>
    </select>

    <select id="machineFilter">
        <option value="">All Machines</option>
    </select>

    <button onclick="applyFilters()">Apply Filters</button>
    <button onclick="resetFilters()">Reset</button>
</div>

<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>User</th>
            <th>Machine</th>
            <th>Sets</th>
            <th>Reps</th>
            <th>Weight</th>
            <th>1RM</th>
            <th>Total Volume</th>
        </tr>
    </thead>
    <tbody id="logBody">
    </tbody>
</table>

<div class="summary" id="summaryBox">
    Total Volume: 0 lbs
</div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyLuqCOn_pvN4Vg6ttQzq1jmZ58Kn79gau3rZ3DpDXD5vWpMO683VsYKMn7xfeleWhfoA/exec";

let fullData = [];
let filteredData = [];

// =============================
// FETCH DATA
// =============================
function fetchWorkouts() {
    fetch(SHEET_URL)
        .then(res => res.json())
        .then(data => {
            fullData = data.reverse(); // newest first
            filteredData = fullData;
            populateFilters();
            renderTable(filteredData);
        })
        .catch(err => {
            console.error("Fetch error:", err);
            alert("Error fetching workout data.");
        });
}

// =============================
// POPULATE DROPDOWNS
// =============================
function populateFilters() {
    const users = [...new Set(fullData.map(e => e.user))];
    const machines = [...new Set(fullData.map(e => e.machine))];

    const userFilter = document.getElementById("userFilter");
    const machineFilter = document.getElementById("machineFilter");

    userFilter.innerHTML = '<option value="">All Users</option>';
    machineFilter.innerHTML = '<option value="">All Machines</option>';

    users.forEach(user => {
        userFilter.innerHTML += `<option value="${user}">${user}</option>`;
    });

    machines.forEach(machine => {
        machineFilter.innerHTML += `<option value="${machine}">${machine}</option>`;
    });
}

// =============================
// APPLY FILTERS
// =============================
function applyFilters() {
    const selectedUser = document.getElementById("userFilter").value;
    const selectedMachine = document.getElementById("machineFilter").value;

    filteredData = fullData.filter(entry =>
        (selectedUser === "" || entry.user === selectedUser) &&
        (selectedMachine === "" || entry.machine === selectedMachine)
    );

    renderTable(filteredData);
}

// =============================
// RESET FILTERS
// =============================
function resetFilters() {
    document.getElementById("userFilter").value = "";
    document.getElementById("machineFilter").value = "";
    filteredData = fullData;
    renderTable(filteredData);
}

// =============================
// RENDER TABLE
// =============================
function renderTable(data) {
    const tbody = document.getElementById("logBody");
    const summaryBox = document.getElementById("summaryBox");

    tbody.innerHTML = "";
    let totalVolume = 0;

    data.forEach(entry => {
        const volume = entry.sets * entry.reps * entry.weight;
        totalVolume += volume;

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${new Date(entry.date).toLocaleString()}</td>
            <td>${entry.user}</td>
            <td>${entry.machine}</td>
            <td>${entry.sets}</td>
            <td>${entry.reps}</td>
            <td>${entry.weight}</td>
            <td>${entry.oneRepMax}</td>
            <td>${volume}</td>
        `;
        tbody.appendChild(row);
    });

    summaryBox.textContent = "Total Volume: " + totalVolume + " lbs";
}

// =============================
// INIT
// =============================
fetchWorkouts();
</script>

</body>
</html>